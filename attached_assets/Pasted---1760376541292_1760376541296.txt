🧩 التعليمات الدقيقة للمطور أو الذكاء الاصطناعي (لا تغيّر أي شيء خارج ما هو مطلوب):

عدّل المشروع الحالي فقط بإضافة وتنفيذ التعديلات التالية، دون حذف أو تعديل أي أكواد أو واجهات حالية غير مذكورة هنا:

1️⃣ استيراد المرضى من ملف Excel

أضف وظيفة جديدة (أو صفحة فرعية في البرنامج) لاسمها import_patients.

تستخدم مكتبة openpyxl أو pandas لاستيراد ملف Excel.

يجب التأكد من:

عدم حصول أي كراش عند الاستيراد (استخدم try/except).

عرض نافذة معاينة قبل الحفظ فيها عدد السجلات الصحيحة وعدد السجلات التي تحتوي أخطاء مع ذكر السبب.

يتم الحفظ داخل قاعدة البيانات بالدفعات الصغيرة (batch insert).

تسجيل العملية في log محلي (import_log.txt أو جدول في قاعدة البيانات).

لا تغيّر أي شيء في واجهات أو جداول المرضى الأصلية، فقط أضف ميزة الاستيراد.

2️⃣ صلاحيات المستخدم

أضف نظام صلاحيات بسيط يعتمد على الحقل role في جدول المستخدمين.

يوجد نوعان:

Admin: يمكنه إضافة، تعديل، حذف.

User: يمكنه الإضافة فقط، ولا يمكنه تعديل أو حذف أي شيء.

عند محاولة المستخدم (User) تعديل أو حذف، أظهر رسالة:

⚠️ غير مصرح لك بتعديل أو حذف البيانات.


أضف حماية داخل الكود بحيث لا تنفذ عمليات تعديل أو حذف من المستخدم العادي حتى لو حاول الوصول بالاختصارات أو الكود.

لا تغيّر نظام الدخول أو التصميم الحالي، فقط فعّل الصلاحيات على الأزرار والأوامر.

3️⃣ الآلة الحاسبة

عدّل تصميم الآلة الحاسبة فقط بحيث تكون الأزرار مرتبة بالشكل التالي من اليسار إلى اليمين:

7 8 9
4 5 6
1 2 3
0 . =


واجعل حقل عرض الأرقام (QLineEdit أو QLabel) باتجاه LTR حتى تظهر الأرقام من الشمال إلى اليمين.

لا تغيّر منطق العمليات الحسابية الحالي إطلاقًا.

4️⃣ صفحة محرر النصوص (Text Editor)

أضف صفحة جديدة داخل البرنامج تحتوي على محرر نصوص (QTextEdit) يدعم:

تنسيقات النصوص (Bold, Italic, Underline, Align Left/Center/Right).

حفظ النص كملف محلي (.txt أو .docx).

فتح أي ملف محفوظ مسبقًا.

طباعة النص مباشرة.

استخدم مكتبة python-docx لحفظ الملفات كـ Word.

أضف هذه الصفحة إلى القائمة الجانبية أو قائمة الأدوات دون تغيير ترتيب الصفحات الحالية.

5️⃣ تحديث سعر السجائر وتأثيره على كشوف المرضى

عند تعديل السعر في صفحة السجائر:

يعرض البرنامج نافذة تأكيد توضح عدد المرضى المتأثرين وإجمالي الفروق المالية الناتجة.

بعد التأكيد، يُعاد حساب تكلفة السجائر في كل كشف حساب قديم وفقًا للمعادلة:

تكلفة السجائر = السعر_الجديد × عدد_السجائر_اليومية × عدد_أيام_الإقامة


يتم تحديث الأعمدة (إجمالي، متبقي) تلقائيًا.

سجل العملية في جدول audit_log أو ملف log.txt، مع حفظ السعر القديم والجديد وتاريخ التعديل.

لا تغيّر تصميم صفحة السجائر أو طريقة عرضها، فقط أضف هذه الوظيفة.

⚠️ ملاحظات مهمة جدًا:

لا تحذف أو تعدل أي كود أو دالة أو واجهة غير مذكورة أعلاه.

أضف الأكواد الجديدة داخل ملفات فرعية منفصلة (أو داخل أقسام مع تعليقات # --- NEW FEATURE ---).

لا تغيّر شكل الواجهة أو ترتيب القوائم الحالية.

استخدم نفس قاعدة البيانات والاتصال الحاليين.

احتفظ بجميع البيانات القديمة كما هي دون حذف أو تعديل.

💾 المكتبات المطلوبة (أضفها فقط إن لم تكن موجودة):

pip install openpyxl python-docx PyQt6


🎯 النتيجة المتوقعة:
بعد تنفيذ التعديلات، يعمل البرنامج كالمعتاد ولكن:

يمكن استيراد المرضى من Excel بأمان.

المستخدم العادي (User) لا يمكنه تعديل أو حذف.

الآلة الحاسبة تعرض الأرقام بالاتجاه الصحيح.

توجد صفحة محرر نصوص احترافية يمكن حفظ وطباعة ملفاتها.

تعديل سعر السجائر يحدّث جميع الكشوف القديمة تلقائيًا.

دون أي تأثير على باقي النظام أو البيانات أو التصميم.